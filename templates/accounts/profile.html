
{% extends 'base.html' %}
{% load static %}

{% block title %}Profile - AI Platform{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <h1>Profile Settings</h1>
    </div>

    <div class="profile-grid">
        <!-- Profile Information Section -->
        <div class="profile-section">
            <h2>Profile Information</h2>
            <form method="post" class="profile-form">
                {% csrf_token %}
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="id_first_name">First Name</label>
                        {{ form.first_name }}
                    </div>
                    <div class="form-group">
                        <label for="id_last_name">Last Name</label>
                        {{ form.last_name }}
                    </div>
                </div>

                <div class="form-group">
                    <label for="id_email">Email Address</label>
                    {{ form.email }}
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="id_company">Company</label>
                        {{ form.company }}
                    </div>
                    <div class="form-group">
                        <label for="id_job_title">Job Title</label>
                        {{ form.job_title }}
                    </div>
                </div>

                <div class="form-group">
                    <label for="id_phone">Phone Number</label>
                    {{ form.phone }}
                </div>

                <div class="form-group">
                    <label for="id_bio">Bio</label>
                    {{ form.bio }}
                </div>

                <!-- Add Theme Preference Section -->
                <div class="form-group">
                    <label for="id_theme_preference">Theme Preference</label>
                    {{ form.theme_preference }}
                </div>

                <div class="form-group">
                    <label>Notification Preferences</label>
                    <div class="checkbox-group">
                        {% for choice in form.notification_preferences %}
                        <div class="checkbox-item">
                            {{ choice.tag }}
                            <label for="{{ choice.id_for_label }}">{{ choice.choice_label }}</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>

        <!-- Subscription Status Section -->
        <div class="profile-section">
            <h2>Subscription Status</h2>
            <div class="subscription-info">
                {% if subscription %}
                    <div class="subscription-details">
                        <p class="plan-name">{{ subscription.plan.name }}</p>
                        <p class="status">Status: <span class="badge badge-{{ subscription.status }}">{{ subscription.status|title }}</span></p>
                        <p>Valid until: {{ subscription.end_date|date:"M d, Y" }}</p>
                    </div>
                    <div class="usage-stats">
                        <h3>API Usage</h3>
                        <div class="progress-bar">
                            <div class="progress" style="width: {{ usage_percentage }}%"></div>
                        </div>
                        <p class="usage-text">{{ api_calls_used }} / {{ api_calls_limit }} API calls used</p>
                    </div>
                {% else %}
                    <div class="subscription-empty">
                        <p>No active subscription</p>
                        <a href="{% url 'billing:pricing' %}" class="btn btn-primary">View Plans</a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- API Keys Section -->
        <div class="profile-section">
            <div class="section-header">
                <h2>API Keys</h2>
                <button class="btn btn-primary" id="showGenerateForm">Generate New Key</button>
            </div>
            
            <div class="api-keys-list">
                {% for key in api_keys %}
                <div class="api-key-item">
                    <div class="key-info">
                        <h3>{{ key.name }}</h3>
                        <div class="key-value">
                            <code>{{ key.key }}</code>
                            <button class="copy-btn" data-clipboard-text="{{ key.key }}" title="Copy API Key">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <p class="key-meta">Created: {{ key.created_at|date:"M d, Y" }}</p>
                    </div>
                    <div class="key-actions">
                        <button class="btn btn-danger revoke-key-btn" 
                                data-key-id="{{ key.id }}"
                                data-key-name="{{ key.name }}">
                            Revoke
                        </button>
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <p>No API keys generated yet.</p>
                </div>
                {% endfor %}
            </div>

            <form method="post" action="{% url 'accounts:generate_api_key' %}" 
                  class="generate-key-form" id="generateKeyForm">
                {% csrf_token %}
                <div class="form-group">
                    <label for="keyName">Key Name</label>
                    <input type="text" id="keyName" name="name" 
                           placeholder="Enter a name for your API key" 
                           required maxlength="50" autocomplete="off">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Generate Key</button>
                    <button type="button" class="btn btn-secondary" id="cancelGenerate">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
<script src="{% static 'js/profile.js' %}"></script>
{% endblock %}
